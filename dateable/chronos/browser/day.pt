<html metal:use-macro="context/main_template/macros/master" i18n:domain="chronos">
<head>
  <metal:block fill-slot="style_slot">
      <style type="text/css" media="all" 
          tal:content="string:@import url(${context/absolute_url}/chronos.css);" />
  </metal:block>
  <metal:block metal:fill-slot="head_slot">
         <script type="text/javascript" src="jquery.js" 
             tal:attributes="src string:${context/++resource++chronos_support/jquery-1.2.1.js}"></script>
    </metal:block>
</head>

<body>
<metal:block fill-slot="main" tal:define="dummy view/calcInfo">

<div id="chronos-calendar">
  <!-- The calendar, rendered as a table -->
  <div metal:use-macro="here/@@chronos_macros/calendar_view_tabs" />
  <table class="ploneCalendar" id="chronos-day" summary="Calendar">
    <thead>
  <tr>
    <th id="calendar-previous">
      <a href="#" rel="nofollow"
         title="Previous day"
         tal:attributes="href view/getPreviousViewUrl">&laquo;</a>
    </th>
    <th>
        <span i18n:translate="" tal:omit-tag=""
              tal:define="day view/getDate">
              <tal:block content="string:calendar_day_${day/weekday}" i18n:translate="" />
              <tal:block replace="python:view.get_short_date(day)" />
              <a class="addEventShortcut"
                title="Add event"
                i18n:attributes="title"
                tal:attributes="href view/getEventCreationLink"
                tal:condition="view/canCreateEvents"
                >
                +
              </a>
              <!-- Navigation drop down commented out until it works
              <img src="#" tal:attributes="src string:${context/++resource++chronos_support/event-icon.gif}" onclick="$('#chronosPopupCalendar').toggle()" />
              <div id="chronosPopupCalendar" tal:define="parentview nocall:view" style="width:200px; position:absolute; z-index: 5; display:none;">
                <metal:block use-macro="context/@@chronos_popup/calendar" />
              </div>
              /-->
              <tal:block tal:replace='structure string:<script type="text/javascript">' />
                  
              <tal:block replace="structure string:</script>" />
          </span>
    </th>
      <th id="calendar-next">
          <a href="#" rel="nofollow"
             title="Next day"
             tal:attributes="href view/getNextViewUrl">&raquo;</a>
      </th>
    </tr>
    </thead>
  <tr>
    <td metal:define-macro="hour_labels" class="hourLabels">
      <div style="position: relative;">
        <!--Printing hours. TODO: Take care of am/pm or 24h format settings.-->
        <tal:block repeat="hour python:range(view.from_hour, view.to_hour)">
          <div class="hourLabel"
               tal:attributes="style python:'top:%spx;;' % ((repeat['hour'].index + 1) * view.hour_height)">
            <tal:block replace="python:'%02d:00'% hour" />
          </div>
        </tal:block>
      </div>
    </td>
    <td metal:define-macro="week_body" class="calendarBody" colspan="2"
        tal:attributes="style string:height: ${view/height}px;; width: ${view/width}px;;">
    <div style="position: relative;">
      <!--The hour lines-->

      <!--The before first hour line-->
      <tal:block condition="view/from_hour">
        <div
          class="hourLabel outOfficeHours"
          tal:attributes="style python:'height: %spx;; top:0px;;' % view.hour_height;"
          >
        </div>
      </tal:block>

      <!-- The main lines -->
      <tal:block repeat="hour python:range(view.from_hour, view.to_hour)">
        <div
          class="hourLabel inOfficeHours"
          tal:attributes="style python:'height: %spx;; top:%spx;;' % (view.hour_height, (repeat['hour'].index +1) * view.hour_height);"
          >
        </div>
      </tal:block>

      <!--The after last hour line-->
      <tal:block condition="view/from_hour">
        <div
          class="hourLabel outOfficeHours"
          tal:attributes="style python:'height: %spx;; top:%spx;;' % (view.hour_height, (view.hour_count + 1) * view.hour_height);"
          >
        </div>
      </tal:block>

        <!--The events-->
        <tal:block repeat="display python:view.getEventDisplays()">
          <!-- TODO: Let the event determine the class -->
          <div metal:use-macro="here/@@chronos_macros/standard_event" />
        </tal:block>
      </div>
    </td>
  </tr>
</table>

</metal:block>

</body>
</html>
